% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/aleStrategy.R
\name{aleStrategy}
\alias{aleStrategy}
\title{aleStrategy: Generalized additive decomposition based on ALE effects.}
\description{
Implements the effectStrategy interface for ALE-based trees: preprocessing via
\code{prepare_split_data_ale}, node-wise ALE transform, heterogeneity from ALE
derivatives, and best-split search. Used by \code{gadgetTree} when \code{strategy = "ale"}.
}
\details{
Intended for use through \code{gadgetTree$new(strategy = aleStrategy$new())} and
\code{tree$fit(...)}. Can be instantiated directly for custom pipelines.
}
\examples{
\dontrun{
ale_strat = aleStrategy$new()
tree = gadgetTree$new(strategy = ale_strat, n.split = 2)
tree$fit(model = model, data = data, target.feature.name = "y")
}

}
\seealso{
\code{\link{calculate_ale_heterogeneity_cpp}}
}
\section{Super class}{
\code{\link[gadget:effectStrategy]{gadget::effectStrategy}} -> \code{aleStrategy}
}
\section{Public fields}{
\if{html}{\out{<div class="r6-fields">}}
\describe{
\item{\code{tree_ref}}{Reference to the associated \code{gadgetTree} instance.}

\item{\code{fit_timing}}{Named numeric vector with global/regional fit times (seconds).}

\item{\code{model}}{Fitted model (persistent after \code{fit}).}

\item{\code{data}}{Data frame or data.table with features and target (persistent after \code{fit}).}

\item{\code{target.feature.name}}{Character(1). Name of the target variable.}

\item{\code{n.intervals}}{Integer. Number of intervals for numeric ALE.}

\item{\code{predict.fun}}{Function. \code{function(model, data)} returning predictions.}

\item{\code{order.method}}{Character. Categorical level ordering: \code{"mds"}, \code{"pca"},
\code{"random"}, or \code{"raw"} (keep existing factor level order; default \code{"mds"}).}

\item{\code{with_stab}}{Logical. Whether boundary-stabilized splits are enabled.}

\item{\code{effect_root}}{Cached ALE effect list at the root node (used by \code{$plot()}).}
}
\if{html}{\out{</div>}}
}
\section{Methods}{
\subsection{Public methods}{
\itemize{
\item \href{#method-aleStrategy-new}{\code{aleStrategy$new()}}
\item \href{#method-aleStrategy-preprocess}{\code{aleStrategy$preprocess()}}
\item \href{#method-aleStrategy-node_transform}{\code{aleStrategy$node_transform()}}
\item \href{#method-aleStrategy-heterogeneity}{\code{aleStrategy$heterogeneity()}}
\item \href{#method-aleStrategy-find_best_split}{\code{aleStrategy$find_best_split()}}
\item \href{#method-aleStrategy-plot}{\code{aleStrategy$plot()}}
\item \href{#method-aleStrategy-fit}{\code{aleStrategy$fit()}}
\item \href{#method-aleStrategy-clean}{\code{aleStrategy$clean()}}
\item \href{#method-aleStrategy-clone}{\code{aleStrategy$clone()}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-aleStrategy-new"></a>}}
\if{latex}{\out{\hypertarget{method-aleStrategy-new}{}}}
\subsection{Method \code{new()}}{
Initialize the strategy with name "ale".
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{aleStrategy$new()}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-aleStrategy-preprocess"></a>}}
\if{latex}{\out{\hypertarget{method-aleStrategy-preprocess}{}}}
\subsection{Method \code{preprocess()}}{
Preprocess data into split-feature matrix Z and ALE effect list Y by calling \code{prepare_split_data_ale}.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{aleStrategy$preprocess(
  model,
  data,
  target.feature.name,
  n.intervals,
  feature.set = NULL,
  split.feature = NULL,
  predict.fun = NULL,
  order.method = "mds"
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{model}}{Fitted model object.}

\item{\code{data}}{Data frame or data.table with features and target.}

\item{\code{target.feature.name}}{Character(1). Name of the target variable.}

\item{\code{n.intervals}}{Integer. Number of intervals for numeric ALE.}

\item{\code{feature.set}}{Character or NULL. Features to compute ALE for; NULL = all.}

\item{\code{split.feature}}{Character or NULL. Features to consider for splitting; NULL = all.}

\item{\code{predict.fun}}{Function or NULL. Prediction function; NULL uses mlr3-style default.}

\item{\code{order.method}}{Character. Categorical level order: \code{"mds"}, \code{"pca"},
\code{"random"}, or \code{"raw"} (keep existing factor level order; default \code{"mds"}).}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
List with \code{Z} (data.table of split features) and \code{Y} (named list of ALE effect data.tables).
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-aleStrategy-node_transform"></a>}}
\if{latex}{\out{\hypertarget{method-aleStrategy-node_transform}{}}}
\subsection{Method \code{node_transform()}}{
Transform ALE effects for a node: subset by \code{idx}, handle single-value and recalc categorical as needed.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{aleStrategy$node_transform(Y, idx, split.feature = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{Y}}{List. ALE effect list (each element a data.frame/data.table from \code{calculate_ale}).}

\item{\code{idx}}{Integer. Row indices of samples in the node.}

\item{\code{split.feature}}{Character(1) or NULL. Feature used for the split leading to this node.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
List of transformed ALE effect data.tables.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-aleStrategy-heterogeneity"></a>}}
\if{latex}{\out{\hypertarget{method-aleStrategy-heterogeneity}{}}}
\subsection{Method \code{heterogeneity()}}{
Compute heterogeneity (variance of ALE derivatives) per feature from effect list \code{Y}.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{aleStrategy$heterogeneity(Y)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{Y}}{List. ALE effect list (each element a data.table from \code{calculate_ale}).}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Numeric vector of heterogeneity, one per feature.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-aleStrategy-find_best_split"></a>}}
\if{latex}{\out{\hypertarget{method-aleStrategy-find_best_split}{}}}
\subsection{Method \code{find_best_split()}}{
Find the best split for a node by ALE heterogeneity reduction.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{aleStrategy$find_best_split(Z, Y, min.node.size, n.quantiles)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{Z}}{Data frame or data.table. Split-feature matrix (columns = \code{split.feature}).}

\item{\code{Y}}{List. ALE effect list from \code{calculate_ale}.}

\item{\code{min.node.size}}{Integer(1). Minimum node size.}

\item{\code{n.quantiles}}{Integer(1) or NULL. Quantile-based candidate cutpoints for numeric features.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
List with best split feature, cutpoint/level, and related fields.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-aleStrategy-plot"></a>}}
\if{latex}{\out{\hypertarget{method-aleStrategy-plot}{}}}
\subsection{Method \code{plot()}}{
Visualize ALE curves for selected nodes by delegating to \code{plot_tree_ale()}.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{aleStrategy$plot(
  tree,
  effect = NULL,
  data,
  target.feature.name,
  depth = NULL,
  node.id = NULL,
  features = NULL,
  show.plot = TRUE,
  show.point = FALSE,
  mean.center = TRUE,
  ...
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{tree}}{Depth-based list of Node objects (typically from \code{convert_tree_to_list}).}

\item{\code{effect}}{Optional ALE effect list (from \code{calculate_ale}); if \code{NULL},
uses the cached \code{effect_root} from the last \code{$fit()} call.}

\item{\code{data}}{Data frame or data.table used for plotting (same data passed to \code{$fit()}).}

\item{\code{target.feature.name}}{Character(1). Name of the target variable.}

\item{\code{depth}}{Optional integer vector of depths to plot.}

\item{\code{node.id}}{Optional integer vector of node ids to plot.}

\item{\code{features}}{Optional character vector of feature names to include.}

\item{\code{show.plot}}{Logical. If \code{TRUE}, print plots as they are created.}

\item{\code{show.point}}{Logical. If \code{TRUE}, overlay observation points.}

\item{\code{mean.center}}{Logical. Whether to mean-center ALE curves (default \code{TRUE}).}

\item{\code{...}}{Passed on to \code{plot_tree_ale()}.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-aleStrategy-fit"></a>}}
\if{latex}{\out{\hypertarget{method-aleStrategy-fit}{}}}
\subsection{Method \code{fit()}}{
Fit an ALE tree: run \code{preprocess} to get Z and Y, then grow the tree by recursive splitting.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{aleStrategy$fit(
  tree,
  model,
  data,
  target.feature.name,
  n.intervals = 10,
  feature.set = NULL,
  split.feature = NULL,
  predict.fun = NULL,
  order.method = "raw",
  with_stab = FALSE,
  ...
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{tree}}{\code{gadgetTree} instance.}

\item{\code{model}}{Fitted model.}

\item{\code{data}}{Data frame or data.table (features and target).}

\item{\code{target.feature.name}}{Character(1). Target variable name.}

\item{\code{n.intervals}}{Integer. Number of intervals for numeric ALE (default 10).}

\item{\code{feature.set}}{Character or NULL. Features to compute ALE for; NULL = all.}

\item{\code{split.feature}}{Character or NULL. Features to split on; NULL = all.}

\item{\code{predict.fun}}{Function or NULL. Prediction function; NULL = default.}

\item{\code{order.method}}{Character. Categorical level order: \code{"mds"}, \code{"pca"},
\code{"random"}, or \code{"raw"} (keep existing factor level order; default \code{"mds"}).}

\item{\code{with_stab}}{Logical. Whether to enable ALE boundary stabilizer in splitting.}

\item{\code{...}}{Ignored.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
The \code{tree} object, invisibly.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-aleStrategy-clean"></a>}}
\if{latex}{\out{\hypertarget{method-aleStrategy-clean}{}}}
\subsection{Method \code{clean()}}{
Clean up large objects (data, model) after fitting to save memory.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{aleStrategy$clean()}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-aleStrategy-clone"></a>}}
\if{latex}{\out{\hypertarget{method-aleStrategy-clone}{}}}
\subsection{Method \code{clone()}}{
The objects of this class are cloneable with this method.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{aleStrategy$clone(deep = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deep}}{Whether to make a deep clone.}
}
\if{html}{\out{</div>}}
}
}
}
