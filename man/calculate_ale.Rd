% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calculate_ale.R
\name{calculate_ale}
\alias{calculate_ale}
\title{Calculate Accumulated Local Effects (ALE)}
\usage{
calculate_ale(
  model,
  data,
  feature.set,
  target.feature.name,
  n.intervals = 10,
  predict.fun = NULL
)
}
\arguments{
\item{model}{Fitted model object with a predict interface.}

\item{data}{Data frame or data.table. Training data (features and target).}

\item{feature.set}{Character. Names of features to compute ALE for; must exist in \code{data}.}

\item{target.feature.name}{Character. Name of the target variable in \code{data}.}

\item{n.intervals}{Integer. Number of equal-frequency intervals for numeric features (default: 10).}

\item{predict.fun}{Function or NULL. \code{function(model, data)} returning a numeric vector of predictions; NULL uses an mlr3-style default.}
}
\value{
Named list of data.tables, one per element of \code{feature.set}. Each data.table has columns:
  \item{row.id}{Row index in \code{data}.}
  \item{feat.val}{Feature value at that row.}
  \item{x.left, x.right}{Interval/category boundaries (numeric) or left/right category (factor).}
  \item{dL}{Local effect (finite difference).}
  \item{interval.index}{Interval or category index.}
  \item{int_n, int_s1, int_s2}{Per-interval count and sum(dL), sum(dL^2) for heterogeneity.}
}
\description{
Computes sample-level ALE data as local finite differences for each specified
feature. Output is used for tree splitting, heterogeneity measures, or visualization.
}
\details{
Numeric features: builds \code{n.intervals} quantile-based intervals, assigns each row to an interval, and computes finite differences between interval boundaries via \code{predict.fun}.

Categorical features: use factor levels as given (typically pre-ordered by \code{order_categorical_levels} in \code{prepare_split_data_ale}). For each row, \code{dL} is the difference in predictions when the focal feature is set to the next vs. previous level; single-level factors get \code{dL = 0}.

Sample-level columns (\code{row.id}, \code{feat.val}, \code{dL}, etc.) support subsetting by node and downstream heterogeneity calculation.
}
